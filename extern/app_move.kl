PROGRAM appmove

%COMMENT = 'appmove v1'
%NOLOCKGROUP
%NOPAUSE=ERROR+COMMAND+TPENABLE
%NOBUSYLAMP

CONST 
	JR_MOTION = 1
	CR_MOTION = 2
	CA_MOTION = 3
	JA_MOTION = 4
	
VAR
--get parameters
	mt: STRING[3]

--program parameter
	rf_ :FILE
	STATUS: INTEGER
	
-- option type is related to mt url parameter
	opt: INTEGER
	
	currentPos: XYZWPREXT
	currentPosJ: JOINTPOS

ROUTINE check_mtp_ : INTEGER FROM appmove

BEGIN
	
	currentPos = CURPOS(0,0);
	currentPosJ = CURJPOS(0,0);
	
	OPEN FILE rf_ ('RW', 'RD:RESPONSE.HTM')
	STATUS = IO_STATUS(rf_)
	IF (STATUS <> 0) THEN
		WRITE rf_ ( '{"result":"failed", "program":"appmotion", "reason":',STATUS,'}') 
	ENDIF

	opt = check_mtp_
	
	SELECT opt OF
		CASE (JR_MOTION):
			
			WRITE ('relative joint motion', CR)
			WRITE (currentPosJ, CR)
			
			WRITE rf_ ( '{"result":"succes", "program":"appmotion", "reason":',opt,'}')
		CASE (JA_MOTION):
		
			WRITE ('absolut joint motion', CR)
			WRITE (currentPosJ, CR)
		
			WRITE rf_ ( '{"result":"succes", "program":"appmotion", "reason":',opt,'}')
		CASE (CR_MOTION):
		
			WRITE ('relative cartesioan motion', CR)		
			WRITE (currentPos, CR)
			
			WRITE rf_ ( '{"result":"succes", "program":"appmotion", "reason":',opt,'}')
		CASE (CA_MOTION): 
		
			WRITE ('absolut cartesioan motion', CR)
			WRITE (currentPos, CR)
			
			WRITE rf_ ( '{"result":"succes", "program":"appmotion", "reason":',opt,'}')
		ELSE:	
			WRITE rf_ ( '{"result":"failed", "program":"appmotion", "reason":',opt,'}') 
	ENDSELECT	

	CLOSE FILE rf_
	
END appmove

ROUTINE check_mtp_
BEGIN
	
	IF (UNINIT(mt)) THEN RETURN (-1); ENDIF
	
	IF (mt = 'jrm') THEN RETURN (JR_MOTION); ENDIF
	IF (mt = 'jam') THEN RETURN (JA_MOTION); ENDIF
	IF (mt = 'crm') THEN RETURN (CR_MOTION); ENDIF
	IF (mt = 'cam') THEN RETURN (CA_MOTION); ENDIF
	
	RETURN(-1)
END check_mtp_